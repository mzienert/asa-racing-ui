(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{4381:(e,r,t)=>{Promise.resolve().then(t.bind(t,1256))},1256:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>C});var s=t(5155),n=t(5087),a=t(8296),o=t(8424),i=t(6046),l=t(3900),c=t(2115),u=t(628),d=t(3015),f=t(9505);let g="us-west-1_7QUYyy6TP",m="5e3i71vokgv9qccu67hhbevqos";console.log("Auth Helper - Cognito Configuration:"),console.log("User Pool ID:",g),console.log("Client ID:",m),g&&m||console.error("Missing required environment variables: NEXT_PUBLIC_COGNITO_USER_POOL_ID or NEXT_PUBLIC_COGNITO_CLIENT_ID");let h={},p=new u.k({region:"us-west-1"});async function x(e){try{console.log("Initiating login with Client ID:",m);let r=new d.l({AuthFlow:"CUSTOM_AUTH",ClientId:m,AuthParameters:{USERNAME:e}}),t=await p.send(r);return console.log("Login initiated successfully:",t),{success:!0,session:t.Session,challengeName:t.ChallengeName}}catch(e){if(console.error("Error initiating login:",e),e&&"object"==typeof e&&"name"in e){if("NotAuthorizedException"===e.name)return{success:!1,error:"Invalid credentials"};if("UserNotFoundException"===e.name)return{success:!1,error:"User not found"};return{success:!1,error:"message"in e&&"string"==typeof e.message?e.message:"An error occurred during login"}}return{success:!1,error:"An error occurred during login"}}}async function y(e,r,t){try{console.log("Verifying OTP with Client ID:",m);let s=new f.$({ChallengeName:"CUSTOM_CHALLENGE",ClientId:m,ChallengeResponses:{USERNAME:e,ANSWER:r},Session:t}),n=await p.send(s);if(console.log("OTP verification response:",n),n.AuthenticationResult){let{AccessToken:e,RefreshToken:r}=n.AuthenticationResult;return h={accessToken:e,refreshToken:r},localStorage.setItem("accessToken",e||""),localStorage.setItem("refreshToken",r||""),{success:!0,accessToken:e,refreshToken:r}}if(n.ChallengeName)return{success:!1,challengeName:n.ChallengeName,session:n.Session,error:"Additional challenge required"};return{success:!1,error:"Verification failed"}}catch(e){if(console.error("Error verifying OTP:",e),e&&"object"==typeof e&&"name"in e){if("CodeMismatchException"===e.name)return{success:!1,error:"Incorrect verification code"};if("ExpiredCodeException"===e.name)return{success:!1,error:"Verification code has expired"};return{success:!1,error:"message"in e&&"string"==typeof e.message?e.message:"An error occurred during verification"}}return{success:!1,error:"An error occurred during verification"}}}let v=async()=>{try{let{accessToken:e}=function(){if(h.accessToken)return h;{let e=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken");if(e)return h={accessToken:e,refreshToken:r||void 0}}return{accessToken:void 0,refreshToken:void 0}}();if(!e)return console.log("No access token found, user is not authenticated"),!1;let r="https://xtxfuhrel1.execute-api.us-west-1.amazonaws.com/prod";r.endsWith("/")||(r+="/"),console.log("Using API URL:",r);let t="".concat(r,"auth/verify");console.log("Calling verify endpoint:",t);let s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(console.log("Verify response status:",s.status),!s.ok){console.error("Token verification failed:",s.status);try{let e=await s.json();console.error("Error details:",e)}catch(e){console.error("Could not parse error response",e)}return!1}let n=await s.json();return console.log("Verification response:",n),!0===n.valid}catch(e){return console.error("Error checking authentication:",e),!1}};function N(e){let{isLoading:r,text:t,loadingText:n,className:a="",disabled:o,...i}=e;return(0,s.jsx)("button",{disabled:r||o,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 rounded-md disabled:opacity-50 flex items-center justify-center ".concat(a),...i,children:r?(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):t})}var w=t(1594);let b=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function C(){let e=(0,o.j)(),r=(0,i.useRouter)(),[t,u]=(0,c.useState)(""),[d,f]=(0,c.useState)(""),[g,m]=(0,c.useState)(!1),[h,p]=(0,c.useState)(null),[C,j]=(0,c.useState)(!1),[A,T]=(0,c.useState)(!1),[E,k]=(0,c.useState)(null),[P,S]=(0,c.useState)(null),I=e=>b.test(e)?e.length>50?(k("Email must be less than ".concat(50," characters")),!1):(k(null),!0):(k("Please enter a valid email address"),!1),O=async e=>{if(e.preventDefault(),I(t)){j(!0);try{let e=await x(t);e.success?(p(e.session),m(!0)):k(e.error||"Email not found. Please check and try again.")}catch(e){k("An unexpected error occurred. Please try again later."),console.error("Error during email submission:",e)}finally{j(!1)}}},R=async s=>{if(s.preventDefault(),S(null),6!==d.length){S("Verification code must be ".concat(6," digits"));return}T(!0);try{console.log("Verifying OTP code:",d);let s=await y(t,d,h||"");if(console.log("OTP verification result:",s),s.success&&s.accessToken){console.log("OTP verification successful"),console.log("Token stored by verifyOTP function");try{let s=await v();console.log("Authentication check result:",s),s?(console.log("User is authenticated with API"),e((0,a.gV)({id:t,email:t})),r.push("/admin")):(console.error("API authentication failed"),S("Authentication failed. Please try again."))}catch(e){console.error("Error checking authentication:",e),S("Authentication check failed. Please try again.")}}else console.error("OTP verification failed"),S(s.error||"Invalid verification code. Please try again.")}catch(e){console.error("Error during OTP verification:",e),S("Verification failed. Please try again.")}finally{T(!1)}};return(0,s.jsx)(n.A,{title:"ASA Racing Login",children:(0,s.jsxs)("div",{className:"space-y-6 w-full max-w-sm mx-auto",children:[(0,s.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.p,{type:"email",placeholder:"Email",value:t,onChange:e=>{let r=e.target.value;r.length<=50&&(u(r),E&&k(null))},onBlur:()=>{t&&I(t)},disabled:g||C,className:"w-full ".concat(E?"border-red-500":""),maxLength:50}),E&&(0,s.jsxs)("div",{className:"flex items-center text-red-500 text-sm",children:[(0,s.jsx)(w.A,{className:"h-4 w-4 mr-2"}),E]})]}),!g&&(0,s.jsx)(N,{type:"submit",isLoading:C,text:"Send Code"})]}),g&&(0,s.jsxs)("form",{onSubmit:R,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l.p,{type:"text",placeholder:"Enter verification code",value:d,onChange:e=>{let r=e.target.value;r.length<=6&&f(r)},disabled:A,className:"w-full ".concat(P?"border-red-500":""),maxLength:6}),P&&(0,s.jsxs)("div",{className:"flex items-center text-red-500 text-sm",children:[(0,s.jsx)(w.A,{className:"h-4 w-4 mr-2"}),P]})]}),(0,s.jsx)(N,{type:"submit",isLoading:A,text:"Verify & Login"})]})]})})}},8296:(e,r,t)=>{"use strict";t.d(r,{Ay:()=>o,gV:()=>n,ri:()=>a});let s=(0,t(8943).Z0)({name:"auth",initialState:{isAuthenticated:!1,user:null},reducers:{setUser:(e,r)=>{e.user=r.payload,e.isAuthenticated=!!r.payload},logout:e=>{e.user=null,e.isAuthenticated=!1}}}),{setUser:n,logout:a}=s.actions,o=s.reducer},8424:(e,r,t)=>{"use strict";t.d(r,{G:()=>a,j:()=>n});var s=t(3391);let n=s.wA,a=s.d4},5087:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});var s=t(5155);t(2115);var n=t(9749);let a=e=>{let{children:r,title:t}=e;return(0,s.jsx)("div",{className:"w-1/2 mt-48",children:(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsx)(n.ZB,{children:t})}),(0,s.jsx)(n.Wu,{children:r})]})})}},9749:(e,r,t)=>{"use strict";t.d(r,{Wu:()=>c,ZB:()=>l,Zp:()=>o,aR:()=>i});var s=t(5155),n=t(2115),a=t(1567);let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...n})});o.displayName="Card";let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...n})});i.displayName="CardHeader";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("font-semibold leading-none tracking-tight",t),...n})});l.displayName="CardTitle",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",t),...n})}).displayName="CardDescription";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",t),...n})});c.displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},3900:(e,r,t)=>{"use strict";t.d(r,{p:()=>o});var s=t(5155),n=t(2115),a=t(1567);let o=n.forwardRef((e,r)=>{let{className:t,type:n,...o}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...o})});o.displayName="Input"},1567:(e,r,t)=>{"use strict";t.d(r,{cn:()=>a});var s=t(3463),n=t(9795);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.QP)((0,s.$)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[505,181,228,90,441,517,358],()=>r(4381)),_N_E=e.O()}]);