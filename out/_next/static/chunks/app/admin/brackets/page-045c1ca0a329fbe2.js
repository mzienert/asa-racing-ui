(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[546],{8651:(e,s,r)=>{Promise.resolve().then(r.bind(r,7114))},7114:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>y});var a=r(5155),t=r(2115),l=r(3391),i=r(9749),d=r(7368),n=r(8217),c=r(1567);let o=n.bL,m=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(n.B8,{ref:s,className:(0,c.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",r),...t})});m.displayName=n.B8.displayName;let f=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(n.l9,{ref:s,className:(0,c.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",r),...t})});f.displayName=n.l9.displayName;let u=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(n.UC,{ref:s,className:(0,c.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t})});u.displayName=n.UC.displayName;let x=e=>(null==e?void 0:e.length)||0;var p=r(1812),h=r(3561),g=r(6329),N=r(5684);let v=e=>{let{racer:s}=e,{attributes:r,listeners:t,setNodeRef:l,transform:i,transition:d}=(0,h.gl)({id:s.id}),n={transform:g.Ks.Transform.toString(i),transition:d};return(0,a.jsxs)("div",{ref:l,style:n,...r,...t,className:"p-2 bg-white border-b last:border-b-0 cursor-move hover:bg-gray-50 flex justify-between items-center",children:[(0,a.jsx)("span",{children:s.name}),(0,a.jsxs)("span",{className:"text-gray-500 text-sm",children:["#",s.bibNumber]})]})},b=e=>{let{raceNumber:s,racers:r=[]}=e;return(0,a.jsxs)("div",{className:"relative border rounded-md p-2 w-[220px] bg-white shadow-sm",children:[(0,a.jsxs)("div",{className:"text-sm font-medium mb-2",children:["Race ",s]}),(0,a.jsx)(h.gB,{items:r.map(e=>e.id),strategy:h._G,children:r.map(e=>(0,a.jsx)(v,{racer:e},e.id))})]})},j=e=>{let{racers:s}=e,r=(0,l.wA)(),[i,d]=(0,t.useState)(null),[n,c]=(0,t.useState)(()=>{let e=[];for(let r=0;r<s.length;r+=4)e.push(s.slice(r,r+4));return e}),o=n.length,m=Math.ceil(o/2),f=Math.floor(o/2),[u,x]=(0,t.useState)(Array(m).fill([])),[h,g]=(0,t.useState)([]),[v,j]=(0,t.useState)(Array(f).fill([])),[y,w]=(0,t.useState)([]),S=(0,p.FR)((0,p.MS)(p.AN,{activationConstraint:{distance:8}}));return(0,a.jsxs)(p.Mp,{sensors:S,onDragStart:e=>{let{active:s}=e,r=n.find(e=>e.some(e=>e.id===s.id)),a=null==r?void 0:r.find(e=>e.id===s.id);a&&d(a)},onDragEnd:e=>{d(null);let{active:s,over:a}=e;if(!a)return;let t=s.id,l=a.id;console.log("Before move - Groups:",n.map(e=>e.length)),console.log("Moving racer:",t,"to group with:",l);let i=n.findIndex(e=>e.some(e=>e.id===t)),o=n.findIndex(e=>e.some(e=>e.id===l));-1!==i&&-1!==o&&c(e=>{let s=JSON.parse(JSON.stringify(e)),a=s[i],d=s[o];if(console.log("Initial state:",{activeGroup:a.map(e=>e.id),overGroup:d.map(e=>e.id)}),i===o){let e=a.findIndex(e=>e.id===t),s=a.findIndex(e=>e.id===l),[r]=a.splice(e,1);a.splice(s,0,r)}else{let e=a.findIndex(e=>e.id===t),[s]=a.splice(e,1),r=d.findIndex(e=>e.id===l);if(d.splice(r,0,s),d.length>4){let e=d.pop();a.push(e)}}return[a,d].forEach(e=>{e.forEach((e,s)=>{e.position=s+1,r((0,N.aJ)(e))})}),s})},children:[(0,a.jsxs)("div",{className:"flex gap-8",children:[(0,a.jsxs)("div",{className:"w-[250px]",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Second Chance"}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"space-y-4",children:v.map((e,s)=>(0,a.jsx)(b,{raceNumber:o+s+1,racers:e,position:"left"},"second-chance-".concat(s)))}),f>0&&(0,a.jsx)("div",{children:(0,a.jsx)(b,{raceNumber:o+f+m+1,racers:y,position:"left"})})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"First Round"}),(0,a.jsx)("div",{className:"space-y-4",children:n.map((e,s)=>(0,a.jsx)(b,{raceNumber:s+1,racers:e},"first-round-".concat(s)))})]}),(0,a.jsxs)("div",{className:"w-[250px]",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Eliminations"}),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"space-y-4",children:u.map((e,s)=>(0,a.jsx)(b,{raceNumber:o+f+s+1,racers:e,position:"right"},"semi-final-".concat(s)))}),m>0&&(0,a.jsx)("div",{children:(0,a.jsx)(b,{raceNumber:o+f+m+2,racers:h,position:"right"})})]})]})]}),(0,a.jsx)(p.Hd,{children:i?(0,a.jsxs)("div",{className:"p-2 bg-white border rounded shadow-sm cursor-move flex justify-between items-center",children:[(0,a.jsx)("span",{children:i.name}),(0,a.jsxs)("span",{className:"text-gray-500 text-sm",children:["#",i.bibNumber]})]}):null})]})};function y(){let e=(0,l.d4)(d.G0),s=(0,l.d4)(d.Kq),r=(0,l.d4)(d.tT);return e?(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Bracket Management"}),(0,a.jsxs)(o,{defaultValue:s[0],className:"w-full",children:[(0,a.jsx)(m,{className:"w-full justify-start",children:s.map(e=>(0,a.jsxs)(f,{value:e,children:[e," (",x(r[e]),")"]},e))}),s.map(e=>(0,a.jsx)(u,{value:e,children:(0,a.jsxs)(i.Zp,{children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)("h2",{className:"text-2xl font-semibold",children:[e," Bracket"]})}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)(j,{racers:r[e]})})]})},e))]})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Bracket Management"}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(i.Zp,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your race brackets here."})}),(0,a.jsx)(i.Wu,{className:"flex flex-col items-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Please create a race first"})})]})})})]})}},5684:(e,s,r)=>{"use strict";r.d(s,{Ay:()=>n,G6:()=>t,Wk:()=>d,aJ:()=>i,gj:()=>l});var a=r(8943);let t=(0,a.zD)("racers/loadFromStorage",async()=>{let e=localStorage.getItem("racers");return e?JSON.parse(e):{}}),l=(0,a.zD)("racers/persistRacer",async(e,s)=>{let{rejectWithValue:r}=s,a=localStorage.getItem("racers"),t=a?JSON.parse(a):{},l=Object.values(t).flat().find(s=>s.bibNumber===e.bibNumber);if(l)return r({message:"Duplicate bib number",existingRacer:l});t[e.classId]||(t[e.classId]=[]);let i={...e,id:crypto.randomUUID(),position:t[e.classId].length+1};return t[e.classId].push(i),localStorage.setItem("racers",JSON.stringify(t)),i}),i=(0,a.zD)("racers/updatePersistedRacer",async e=>{var s;let r=localStorage.getItem("racers"),a=r?JSON.parse(r):{},t=null===(s=a[e.classId])||void 0===s?void 0:s.findIndex(s=>s.id===e.id);return void 0!==t&&-1!==t&&(a[e.classId][t]=e,localStorage.setItem("racers",JSON.stringify(a))),e}),d=(0,a.zD)("racers/deletePersistedRacer",async e=>{let{id:s,classId:r}=e,a=localStorage.getItem("racers"),t=a?JSON.parse(a):{};return t[r]=t[r].filter(e=>e.id!==s),localStorage.setItem("racers",JSON.stringify(t)),{id:s,classId:r}}),n=(0,a.Z0)({name:"racers",initialState:{racers:{}},reducers:{},extraReducers:e=>{e.addCase(t.fulfilled,(e,s)=>{e.racers=s.payload}).addCase(l.fulfilled,(e,s)=>{let{classId:r}=s.payload;e.racers[r]||(e.racers[r]=[]),e.racers[r].push(s.payload)}).addCase(i.fulfilled,(e,s)=>{var r;let{id:a,classId:t}=s.payload,l=null===(r=e.racers[t])||void 0===r?void 0:r.findIndex(e=>e.id===a);void 0!==l&&-1!==l&&(e.racers[t][l]=s.payload)}).addCase(d.fulfilled,(e,s)=>{let{id:r,classId:a}=s.payload;e.racers[a]=e.racers[a].filter(e=>e.id!==r)})}}).reducer},7368:(e,s,r)=>{"use strict";r.d(s,{G0:()=>t,Gv:()=>d,Is:()=>l,Kq:()=>i,tT:()=>n});var a=r(4399);let t=e=>e.races.some(e=>!1===e.completed),l=e=>e.races.find(e=>!1===e.completed),i=e=>{let s=l(e);return(null==s?void 0:s.raceClasses)||[]},d=(e,s)=>e.racers.racers[s]||[],n=(0,a.Mz)([i,e=>e],(e,s)=>e.reduce((e,r)=>({...e,[r]:d(s,r)}),{}))},9749:(e,s,r)=>{"use strict";r.d(s,{Wu:()=>c,ZB:()=>n,Zp:()=>i,aR:()=>d});var a=r(5155),t=r(2115),l=r(1567);let i=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...t})});i.displayName="Card";let d=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...t})});d.displayName="CardHeader";let n=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("font-semibold leading-none tracking-tight",r),...t})});n.displayName="CardTitle",t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",r),...t})}).displayName="CardDescription";let c=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",r),...t})});c.displayName="CardContent",t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",r),...t})}).displayName="CardFooter"},1567:(e,s,r)=>{"use strict";r.d(s,{cn:()=>l});var a=r(3463),t=r(9795);function l(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,t.QP)((0,a.$)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[505,181,399,153,441,517,358],()=>s(8651)),_N_E=e.O()}]);