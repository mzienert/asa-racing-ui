(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{5682:()=>{},4381:(e,s,t)=>{Promise.resolve().then(t.bind(t,9528))},9528:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var a=t(5155),r=t(5087),n=t(8296),i=t(8424),l=t(6046),c=t(3900),o=t(2115),d=t(9845);let u=new d.NE({UserPoolId:"us-west-1_oyUmW0yJZ",ClientId:"696deqdc3gkq4civ3nc9svjn8n"});function m(){return"https://0wq09bpeu5.execute-api.us-west-1.amazonaws.com/prod"}async function f(e){try{if(!u)return{success:!1,message:"Authentication service not available"};let s=e.toLowerCase(),t=new d.TU({Username:s,Pool:u}),a=await new Promise((e,a)=>{t.initiateAuth(new d.By({Username:s,ValidationData:{CUSTOM_CHALLENGE:"INIT"}}),{onSuccess:s=>e({cognitoUser:t,session:s}),onFailure:a,customChallenge:s=>e({cognitoUser:t,challengeParameters:s})})});return{success:!0,message:"OTP sent to email",sessionData:a.cognitoUser.Session}}catch(e){if("NotAuthorizedException"===e.name||"UserNotFoundException"===e.name)return{success:!1,message:"Email not found. Please check and try again."};return console.error("Unexpected auth error:",e),{success:!1,message:"Unable to process request. Please try again later."}}}async function p(e,s,t){if(console.log("Starting verifyOTP with session:",!!t),!t)return{success:!1,message:"Session expired. Please request a new code."};try{let a=e.toLowerCase(),r=new d.TU({Username:a,Pool:u});r.Session=t;let n=await new Promise((e,a)=>{r.sendCustomChallengeAnswer(s,{onSuccess:s=>e(s),onFailure:e=>{"Incorrect username or password."===e.message&&(r.Session=t),a(e)}})}),i=n.getAccessToken().getJwtToken(),l=n.getIdToken().getJwtToken();return await fetch("".concat(m(),"/auth/manage-session"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:i,idToken:l})}),await fetch("".concat(m(),"/auth/manage-session/verify"),{credentials:"include",headers:{"Content-Type":"application/json"}}),{success:!0,message:"Login successful"}}catch(e){if(console.log("Caught error:",e.name,e.message),"Incorrect username or password."===e.message)return{success:!1,message:"Incorrect verification code. Please try again."};return{success:!1,message:"Session expired. Please request a new code."}}}function g(e){let{isLoading:s,text:t,loadingText:r,className:n="",disabled:i,...l}=e;return(0,a.jsx)("button",{disabled:s||i,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 rounded-md disabled:opacity-50 flex items-center justify-center ".concat(n),...l,children:s?(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):t})}var h=t(1594);let x=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function y(){let e=(0,i.j)(),s=(0,l.useRouter)(),[t,d]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[y,w]=(0,o.useState)(!1),[v,b]=(0,o.useState)(null),[N,j]=(0,o.useState)(!1),[S,C]=(0,o.useState)(!1),[A,P]=(0,o.useState)(null),[E,T]=(0,o.useState)(null),U=e=>x.test(e)?e.length>50?(P("Email must be less than ".concat(50," characters")),!1):(P(null),!0):(P("Please enter a valid email address"),!1),k=async e=>{if(e.preventDefault(),U(t)){j(!0);try{let e=await f(t);e.success?(b(e.sessionData),w(!0)):P(e.message||"Email not found. Please check and try again.")}catch(e){P("An unexpected error occurred. Please try again later."),console.error("Error during email submission:",e)}finally{j(!1)}}},L=async a=>{if(a.preventDefault(),T(null),6!==u.length){T("Verification code must be ".concat(6," digits"));return}C(!0);try{let a=await p(t,u,v);a.success?(e((0,n.gV)({id:"1",email:t})),s.push("/admin")):T(a.message||"Invalid verification code. Please try again.")}catch(e){T("An unexpected error occurred. Please try again later."),console.error("Error during code submission:",e)}finally{C(!1)}};return(0,a.jsx)(r.A,{title:"ASA Racing Login",children:(0,a.jsxs)("div",{className:"space-y-6 w-full max-w-sm mx-auto",children:[(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.p,{type:"email",placeholder:"Email",value:t,onChange:e=>{let s=e.target.value;s.length<=50&&(d(s),A&&P(null))},onBlur:()=>{t&&U(t)},disabled:y||N,className:"w-full ".concat(A?"border-red-500":""),maxLength:50}),A&&(0,a.jsxs)("div",{className:"flex items-center text-red-500 text-sm",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),A]})]}),!y&&(0,a.jsx)(g,{type:"submit",isLoading:N,text:"Send Code"})]}),y&&(0,a.jsxs)("form",{onSubmit:L,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.p,{type:"text",placeholder:"Enter verification code",value:u,onChange:e=>{let s=e.target.value;s.length<=6&&m(s)},disabled:S,className:"w-full ".concat(E?"border-red-500":""),maxLength:6}),E&&(0,a.jsxs)("div",{className:"flex items-center text-red-500 text-sm",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),E]})]}),(0,a.jsx)(g,{type:"submit",isLoading:S,text:"Verify & Login"})]})]})})}},8296:(e,s,t)=>{"use strict";t.d(s,{Ay:()=>i,gV:()=>r,ri:()=>n});let a=(0,t(8943).Z0)({name:"auth",initialState:{isAuthenticated:!1,user:null},reducers:{setUser:(e,s)=>{e.user=s.payload,e.isAuthenticated=!!s.payload},logout:e=>{e.user=null,e.isAuthenticated=!1}}}),{setUser:r,logout:n}=a.actions,i=a.reducer},8424:(e,s,t)=>{"use strict";t.d(s,{G:()=>n,j:()=>r});var a=t(3391);let r=a.wA,n=a.d4},5087:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var a=t(5155);t(2115);var r=t(9749);let n=e=>{let{children:s,title:t}=e;return(0,a.jsx)("div",{className:"w-1/2 mt-48",children:(0,a.jsxs)(r.Zp,{children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{children:t})}),(0,a.jsx)(r.Wu,{children:s})]})})}},9749:(e,s,t)=>{"use strict";t.d(s,{Wu:()=>o,ZB:()=>c,Zp:()=>i,aR:()=>l});var a=t(5155),r=t(2115),n=t(1567);let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",t),...r})});i.displayName="Card";let l=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...r})});l.displayName="CardHeader";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("font-semibold leading-none tracking-tight",t),...r})});c.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...r})});o.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter"},3900:(e,s,t)=>{"use strict";t.d(s,{p:()=>i});var a=t(5155),r=t(2115),n=t(1567);let i=r.forwardRef((e,s)=>{let{className:t,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...i})});i.displayName="Input"},1567:(e,s,t)=>{"use strict";t.d(s,{cn:()=>n});var a=t(3463),r=t(9795);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[505,181,649,441,517,358],()=>s(4381)),_N_E=e.O()}]);